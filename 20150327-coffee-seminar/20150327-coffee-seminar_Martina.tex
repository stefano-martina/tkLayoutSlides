%\documentclass[gray,handout, pdftex, 11pt]{beamer}
%\documentclass[handout, pdftex, 11pt]{beamer}
\documentclass[pdftex, 11pt]{beamer}

\usepackage{pgfpages}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
%\usepackage[italian]{babel}
\usepackage{graphicx}
\usepackage{microtype}
\usepackage{acronym}
\usepackage{array}
%\usepackage{natbib}
\usepackage{verbatim}
\usepackage{appendixnumberbeamer}
%\usepackage{advdate}
\usepackage{color}
\usepackage{multirow}

\usepackage{relsize}
%% \usepackage{enumitem}

\usepackage{pgffor}

\usepackage{tikz}
\usetikzlibrary{intersections, arrows, shapes, decorations.pathreplacing, decorations.pathmorphing, calc}

%\AdvanceDate[1]

%% \setlistdepth{9}

%% \setlist[itemize,1]{label=$\bullet$}
%% \setlist[itemize,2]{label=$\bullet$}
%% \setlist[itemize,3]{label=$\bullet$}
%% \setlist[itemize,4]{label=$\bullet$}
%% \setlist[itemize,5]{label=$\bullet$}
%% \setlist[itemize,6]{label=$\bullet$}
%% \setlist[itemize,7]{label=$\bullet$}
%% \setlist[itemize,8]{label=$\bullet$}
%% \setlist[itemize,9]{label=$\bullet$}

%% \renewlist{itemize}{itemize}{9}

\definecolor{darkgreen}{rgb}{0.01, 0.75, 0.24}

\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcommand{\cellwidth}{1.2cm}
\newcommand{\svntitlesize}{\tiny}
\newcommand{\svnbodysize}{\tiny}

\newcommand{\cell}[2][c]{%
  \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}
\newcommand{\rowhead}[2]{\cell{\color{red}#1\\ \color{darkgreen}#2}}
\newcommand{\rowheadb}[3]{\cell{#1\\ \color{red}#2\\ #3}}
\newcommand{\cont}[5]{\cell{\color{red}#1\\ \color{blue}#2\\ #3\\ #4\\ \color{darkgreen}#5}}
\newcommand{\deprecont}[5]{\cell{\color{red}#1\\ \color{blue}#2\\ #3\\ #4\\ \color{darkgreen}#5\\ \color{red}Deprecated warning}}
\newcommand{\noacc}{No accumulation}
\newcommand{\acc}{Accumulation}
\newcommand{\noconv}{No conversion}
\newcommand{\sca}{Scaling possible}
\newcommand{\nosca}{Scaling not possible}
\newcommand{\conv}{Conversion}
\newcommand{\module}{\color{red}Module}
\newcommand{\rod}{\color{red}Rod}
\newcommand{\layer}{\color{red}Layer/Disk}
\newcommand{\serfal}{\color{darkgreen}Service=false}
\newcommand{\sertru}{\color{darkgreen}Service=true}
\newcommand{\err}{\color{red}Error}
\newcommand{\depre}{\color{red}Deprecated}
\newcommand{\follsup}{Following supports $S_{R+1}\dots S_i\dots S_N$}
\newcommand{\allsup}{All supports $S_1\dots S_i\dots S_N$}
\newcommand{\modlen}{moduleLength}
\newcommand{\modsur}{moduleSurface}
\newcommand{\nummod}{numModules}
\newcommand{\suplen}{supportLength}
\newcommand{\supsur}{supportSurface}
\newcommand{\mapbar}{\color{red}Barrel}
\newcommand{\mapen}{\color{red}Endcap}

\newcommand{\pat}[1]{\texttt{#1}}
\newcommand{\prop}[1]{\texttt{#1}}

\newcommand{\sym}{$\hookrightarrow$}

\newcommand{\tkl}{TkLayout}

\def\ifmonospace{\ifdim\fontdimen3\font=0pt }
\def\c++{%
\ifmonospace%
    C++%
\else%
    C\kern-.1667em\raise.30ex\hbox{\smaller{++}}%
\fi%
\spacefactor1000 }



\mode<presentation>{
  %-------------------------1
  \usetheme{Boadilla}
  \usecolortheme{beaver}
  %-------------------------1
  %-------------------------2
  %\usetheme{Goettingen}
  %\usecolortheme{sidebartab}
  %-------------------------2
  %\useoutertheme[right]{sidebar}
  %\usefonttheme{default}
  \setbeamercovered{transparent}
  %\setbeameroption{show notes on second screen=right}
  \setbeamertemplate{navigation symbols}{}

  \bibliographystyle{abbrv}  
  %\renewcommand\bibfont{\scriptsize}
  \setbeamertemplate{bibliography item}{\textbullet}
  \setbeamertemplate{itemize item}{\checkmark}
  \setbeamertemplate{itemize subitem}{-}
  \setbeamertemplate{enumerate items}[default]
  \setbeamertemplate{sections/subsections in toc}[square]
}

\title[\tkl]{\textbf{TKLAYOUT, A TOOL FOR CMS TRACKER DESIGN}}
\subtitle{Coffee seminar}
\institute[CERN]{
  %{\Large\textbf{CERN}}\\{European Organization for Nuclear Research}\\[0.5cm]
  %\\[0.2cm]
  European Organization for Nuclear Research\\[0.5cm]
  \includegraphics[width=2cm]{img/LogoBadge.pdf}\\
}

\author[Stefano Martina]{
  %\\[0.2cm]
  \textbf{Stefano MARTINA}\\
  {\small stefano.martina@cern.ch}
}

\date[\today]{\flushright \today}

\makeatletter
\newcommand\ChangeItemFont[3]{%
\renewcommand{\itemize}[1][]{%
  \beamer@ifempty{##1}{}{\def\beamer@defaultospec{#1}}%
  \ifnum \@itemdepth >2\relax\@toodeep\else
    \advance\@itemdepth\@ne
    \beamer@computepref\@itemdepth% sets \beameritemnestingprefix
    \usebeamerfont{itemize/enumerate \beameritemnestingprefix body}%
    \usebeamercolor[fg]{itemize/enumerate \beameritemnestingprefix body}%
    \usebeamertemplate{itemize/enumerate \beameritemnestingprefix body begin}%
    \list
      {\usebeamertemplate{itemize \beameritemnestingprefix item}}
      {\def\makelabel####1{%
          {%
            \hss\llap{{%
                \usebeamerfont*{itemize \beameritemnestingprefix item}%
                \usebeamercolor[fg]{itemize \beameritemnestingprefix item}####1}}%
          }%
        }%
  \ifnum\@itemdepth=1\relax
    #1%
  \else
  \ifnum\@itemdepth=2\relax
    #2%
  \else
  \ifnum\@itemdepth=3\relax
    #3%
  \fi%
  \fi%
  \fi%
  }
  \fi%
  \beamer@cramped%
  \raggedright%
  \beamer@firstlineitemizeunskip%
}}
\makeatother

\newcommand\ChangeItemFontAll[1]{\ChangeItemFont{#1}{#1}{#1}}

\begin{document}

\begin{frame}[plain,noframenumbering]
  \titlepage
\end{frame}

\begin{frame}
  \frametitle{\tkl}
  \begin{itemize}
  \item CMS upgrade \alert{phase 2}
  \item \alert{\tkl} is the tracker design tool
  \item \alert{material} evaluation
  \item \alert{performance} analysis
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Phase 2}
  \begin{itemize}
  \item \alert{outer tracker} at advanced study phase
    \begin{itemize}
    \item \alert{TB2S} consolidate
    \item \alert{TBPS} still different options
      \begin{itemize}
      \item \alert{flat}
      \item \alert{tilted}
      \end{itemize}
    \end{itemize}
  \item \alert{pixel} still open question
    \begin{itemize}
    \item power?
    \item laser?
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{\tkl for phase 2}
  \begin{itemize}
  \item \alert{monitor} material budget
  \item \alert{design} for pixel
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Main functionality}
  \begin{itemize}
  \item predict \alert{material} distribution and effects
  \item predict \alert{resolution}
  \item generate \alert{modules} definition for mechanical
  \item generate \alert{XML} files for simulation
  \end{itemize}
  \begin{block}{Using}
    \begin{itemize}
    \item error \alert{propagation}
    \item \alert{not} use simulations
      \begin{itemize}
      \item[$\rightarrow$] \alert{fast} analysis
      \end{itemize}
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}[fragile]
%  \frametitle{Example configuration}
  \tiny
  \begin{block}{\pat{.../geometries/Baseline2015}}
\begin{verbatim}
Tracker Outer {
    @include Baseline2015_SupportsTracker.cfg

    // Layout construction parameters
    zError 70
    bigDelta 12
    zOverlap 1
    phiOverlap 1
    etaCut 10
    barrelRotation 1.57079632679
    smallParity 1

    trackingTags trigger,tracker

    Barrel TBPS {
      @include Baseline2015_SupportsBarrelTBPS.cfg
      Layer 1   { smallDelta 3.65 }
      Layer 2,3 { smallDelta 3.15 }
      numLayers 3
      maxZ 1150
      startZMode modulecenter
      innerRadius 230
      outerRadius 508 // 509 or 540
      width 96
      length 46.26
      physicalLength 71
      phiSegments 2
    }
...
\end{verbatim}
  \end{block}
\end{frame}


\foreach \n in {1,...,6}{
  \begin{frame}
    \begin{center}
      \includegraphics[width=\textwidth]{img/screenshot\n.png}
    \end{center}
  \end{frame}
}

% \foreach \n in {1,...,2}{
%   \begin{frame}
%     \begin{center}
%       \includegraphics[width=\textwidth]{img/screenshotPdf\n.pdf}
%     \end{center}
%   \end{frame}
% }

\begin{frame}
  \frametitle{Work done}
  \begin{itemize}
  \item \alert{radiation maps}
    \begin{itemize}
    \item multiple maps possible
    \item more precision
    \end{itemize}
  \item \alert{material} model
    \begin{itemize}
    \item configuration files definition
    \item internal representation
    \item routing algorithm
    \end{itemize}
  \item small bug-fix and improvements
  \end{itemize}
\end{frame}

\begin{frame}{Old material model}
  \begin{center}
    \includegraphics[width=\textwidth]{img/oldModel.pdf}
  \end{center}
  \begin{itemize}
  \item Cables material distributed \alert{inside} modules volumes
  \item Possible to model \alert{cooling pipe} along rods, \alert{manifold} in the flange and bigger cooling pipe out of the barrel
  \end{itemize}
\end{frame}

\begin{frame}{New material model}
  \begin{center}
    \includegraphics[width=\textwidth]{img/newModel.pdf}
  \end{center}
  \begin{itemize}
  \item Cables material in \alert{dedicated} volumes
  \item More \alert{detailed}
  \item Better routing \alert{algorithm}
  \item More \alert{functionality}
  \end{itemize}
\end{frame}

\begin{frame}{Advantages}
  \begin{block}{Correct description for \alert{tilted} modules}
    \begin{itemize}
    \item In old model the cables were distributed \alert{over} the modules
      \begin{itemize}
      \item \alert{Not} feasible in case of tilted modules
      \end{itemize}
    \item Now is \alert{possible} to model this design
    \end{itemize}
  \end{block}
  \begin{center}
    \includegraphics[width=\textwidth]{img/tilted.pdf}
  \end{center}
\end{frame}

\begin{frame}{New feature}
  \begin{block}{Model for \alert{pixel-like} materials}
    \begin{itemize}
    \item For instance \alert{twisted pair} from modules, electrical optical \alert{transducer}, and \alert{optic fibres} after it
    \end{itemize}
  \end{block}
  \begin{center}
    \only<1>{\includegraphics[width=\textwidth]{img/electro-opto1.pdf}}
    \only<2>{\includegraphics[width=\textwidth]{img/electro-opto2.pdf}}
    \only<3>{\includegraphics[width=\textwidth]{img/electro-opto3.pdf}}
  \end{center}
\end{frame}

\begin{frame}{Advantages}
  \begin{itemize}
  \item The new algorithm use the \alert{same} underlying c++ objects of the old
  \item This means that the \alert{XML} export is working as usual
    \begin{itemize}
    \item only more \alert{detailed} than before
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}{Validation}
  \begin{enumerate}
  \item \alert{Comparison} between old and new models
  \item Accurate \alert{tests} new model only with controlled amount of material and exact computation of material amount
  \end{enumerate}
\end{frame}

\begin{frame}
  \begin{block}{Test15}
    \alert{$100 g/m$} of \emph{Cu} in the disk of endcap
    \begin{itemize}
    \item \alert{service} true
    \end{itemize}
  \end{block}
  \begin{center}
    \includegraphics[width=9cm]{img/test15.pdf}
  \end{center}
\end{frame}

\begin{frame}
  \fontsize{4.5pt}{6pt}\selectfont
  \begin{center}
    \begin{tabular}{|c|c|c|c|}
      \cline{2-4}
      \multicolumn{1}{c|}{} & \color{darkgreen}Unit=$g/m$ & \color{darkgreen}Unit=$mm$ & \color{darkgreen}Unit=$g$\\
      \hline
      \rowhead{\module}{\serfal} & \cont{\module}{$\times \modlen$}{\noacc}{\noconv}{\sca}& \cont{\module}{$\times \modsur\times \rho$ (sensor surface)}{\noacc}{\noconv}{\sca}& \cont{\module}{$\times 1$}{\noacc}{\noconv}{\sca}\\
      \hline
      \rowheadb{\module}{ring $R$ of $N$}{\sertru} & \cont{\follsup}{$\times \nummod_R \times \suplen_i$}{\acc}{\conv (1:1 by default, with warning)}{\sca} & \deprecont{\follsup}{$\times \nummod_R \times \supsur_i \times \rho$}{\acc}{\conv  (1:1 by default, with warning)}{\sca} & \err \\
      \hline
      \rowhead{\rod (barrel)}{\serfal} & \cont{\allsup}{$\times \nummod_1 \times \suplen_i$}{\noacc}{\noconv}{\nosca} & \cont{\allsup}{$\times \supsur_i \times \rho$}{\noacc}{\noconv}{\nosca} & \cont{\allsup}{$\times \nummod_1 \times \frac{\suplen_i}{\sum_{j=1}^N\suplen_j}$}{\noacc}{\noconv}{\nosca} \\
      \hline
      \rowhead{\rod (barrel)}{\sertru} & \cont{\allsup}{$\times \nummod_1 \times \suplen_i$}{\noacc}{\conv}{\nosca} & \deprecont{\allsup}{$\times \supsur_i \times \rho$}{\noacc}{\conv}{\nosca} & \err \\
      \hline
      \rowhead{\layer}{\serfal} & \cont{\allsup}{$\times \suplen_i$}{\noacc}{\noconv}{\nosca} & \cont{\allsup}{$\times \supsur_i \times \rho$}{\noacc}{\noconv}{\nosca} & \cont{\allsup}{$\times \frac{\suplen_i}{\sum_{j=1}^N\suplen_j}$}{\noacc}{\noconv}{\nosca} \\
      \hline
      \rowhead{\layer}{\sertru} & \cont{\allsup}{$\times \suplen_i$}{\noacc}{\conv}{\nosca} & \deprecont{\allsup}{$\times \supsur_i \times \rho$}{\noacc}{\conv}{\nosca} & \err \\
      \hline
    \end{tabular}
  \end{center}
\end{frame}

\begin{frame}[fragile]{Example configuration}
  \tiny
  \begin{columns}[t]
    \begin{column}{0.47\textwidth}
      \begin{block}{\pat{.../Materials/ptPS}}
\begin{verbatim}
Materials module-ptPS {
  type module

  // Default sensor:
  ReferenceSensor 1 {
    numStripsAcross 960
    numSegments 32
  }
  ReferenceSensor 2 {
    numStripsAcross 960
    numSegments 2
  } 

  // Sensor
  Component {
    componentName Sensor
    service false
    scaleOnSensor 0
    targetVolume 1
    Element {
      elementName SenSi
      quantity 0.2
      unit mm
    }
  }
\end{verbatim}
$\cdots$
      \end{block}
    \end{column}
    \begin{column}{0.47\textwidth}
      \begin{block}{\pat{.../Materials/rodPtPS}}
\begin{verbatim}
Materials rodPtPS {
  type rod

  Component {
    componentName Cooling
    service true
    scaleOnSensor 0
    Element {
      elementName Steel
      quantity 7.860696517
      unit g/m
    }
    Element {
      elementName CO2
      quantity 1.791044776
      unit g/m
    }
  }
\end{verbatim}
$\cdots$
      \end{block}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}[fragile]{Example configuration}
  \tiny
  \begin{columns}[t]
    \begin{column}{0.47\textwidth}
      \begin{block}{\pat{.../Conversions/flange}}
\begin{verbatim}
Station {
  stationName flange
  type flange
...
  Conversion {
    Input {
      Element {
        elementName Cu_MV
        quantity 10
        unit g/m
      }
    }
    Output {
      Element {
        elementName Cu
        quantity 10
        unit g/m
        service true
      }
      Element {
        elementName Cu
        quantity 0.423
        unit g
        service false
      }
\end{verbatim}
$\cdots$
      \end{block}
    \end{column}
    \begin{column}{0.47\textwidth}
      \begin{block}{\pat{.../Conversions/endcap1}}
\begin{verbatim}
Station {
  stationName endcap1
  type second

  minZ 1500
  maxZ 1600

  Conversion {
\end{verbatim}
$\cdots$
      \end{block}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Future features}
  \begin{itemize}
  \item develop configuration files for \alert{pixel} and
    \alert{inspect} possibilities
  \item look for an automated testing framework
  \end{itemize}
\end{frame}
\end{document}

